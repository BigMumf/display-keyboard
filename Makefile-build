
# Fefore running:
# . $HOME/esp/esp-idf/export.sh

# pip install esptool
PORT=/dev/cu.usbserial-GT4YU06W
BAUD=921600
IDF=idf.py
ESPTOOL=esptool.py
FS_BLOCK_SIZE=4096
FS_PAGE_SIZE=256
FS_IMAGE_SIZE=0x100000
PARTITION_OFFSET=0x110000

GIT_SUBMODULES=components/i2clib \
							 components/inih \
							 components/tinyusb \
							 components/lv_port_esp32

.PHONY: format clean target build flash config monitor submodules-update

format:
	clang-format -i main/*.cc main/*.c main/*.h

clean:
	rm -rf build sdkconfig.old

config:
	${IDF} menuconfig

target:
	${IDF} set-target esp32s2

build:
	${IDF} build

flash:
	${IDF} --port ${PORT} --baud ${BAUD} flash monitor

monitor:
	${IDF} --port ${PORT} monitor

.PHONY:
flash-erase:
	${ESPTOOL} --chip esp32s2 --port ${PORT} --baud ${BAUD} erase_flash

submodules-update:
	git submodule update --init ${GIT_SUBMODULES}
	git -C components/lv_port_esp32 submodule update --init components/lvgl/lvgl
